function ExtendedPathParser(a,b,c,d,e,f){"use strict";var g="MmZzLlHhVvCcSsQqTtAa"+e+c+d+f,h="mlhvcsqtaz"+e+c+d+f,i=new RegExp("(["+g+"])(["+g+"])","gm");this.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm," ")},this.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},b=b.replace(/,/gm," "),b=b.replace(i,"$1 $2"),b=b.replace(i,"$1 $2"),i=new RegExp("(["+g+"])([^s])","gm"),b=b.replace(i,"$1 $2"),i=new RegExp("([^s])(["+g+"])","gm"),b=b.replace(i,"$1 $2"),b=b.replace(/([0-9])([+\-])/gm,"$1 $2"),b=b.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),b=b.replace(/([Aa](\s+[0-9]+){3})\s+ ([01])\s*([01])/gm,"$1 $3 $4 "),b=this.compressSpaces(b),b=this.trim(b),i=new RegExp("^["+g+"]$","gm"),this.tokens=b.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new a.Point(0,0),this.control=new a.Point(0,0),this.current=new a.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!==this.tokens[this.i+1].match(i)},this.isRelativeCommand=function(){return-1!==h.indexOf(this.command)},this.getToken=function(){return this.i+=1,this.tokens[this.i]},this.getSubpathRefId=function(){var a="";do a+=this.getToken();while(-1===a.indexOf("|"));for(;-1!==a.indexOf(" ");)a=a.replace(" ","");return a.slice(0,a.indexOf("|"))},this.getSubpathDesc=function(){for(var b=this.getToken(),c=this.getToken();c!==a.ENDCHUNK;)b+=c+" ",c=this.getToken();return b},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(b){var c=new a.Point(this.getScalar(),this.getScalar());return b?c:this.makeAbsolute(c)},this.getAsControlPoint=function(a){var b=this.getPoint(a);return this.control=b,b},this.getAsCurrentPoint=function(a){var b=this.getPoint(a);return this.current=b,b},this.getReflectedControlPoint=function(){if("c"!==this.previousCommand.toLowerCase()&&"s"!==this.previousCommand.toLowerCase()&&"q"!==this.previousCommand.toLowerCase()&&"t"!==this.previousCommand.toLowerCase())return this.current;var b=new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return b},this.makeAbsolute=function(a){return this.isRelativeCommand()&&a.translate(this.current.x,this.current.y),a}}(function(){"use strict";function a(a){return null!==a&&void 0!==a}function b(b){var c,d,e,f,g,h,i="",j=!1;for(c=b.getAttribute("d"),d=c.search(l.DIRECTREF);d>0;)e=c.indexOf(l.SEPARATOR,d+1),-1!==e?(f=c.slice(d+1,e),g=l.DIRECTREF+f+l.SEPARATOR,a(l.chunks[f])&&(i=l.chunks[f].data+" ",b.newpathdata=c=c.replace(g,i),j=!0)):(f=c.slice(d+1),g=l.DIRECTREF+f,a(l.chunks[f])&&(i=l.chunks[f].data,b.newpathdata=c=c.replace(g,i),j=!0)),i="",h=c.slice(d+1).search(l.DIRECTREF),d=-1!==h?d+1+h:-1;return j}function c(b){var c,d,e,f,g,h,i,j=!1;for(c=b.getAttribute("d"),d=c.search(l.REVERSEDREF);d>0;)e=c.indexOf(l.SEPARATOR,d+1),-1!==e?(f=c.slice(d+1,e),g=l.REVERSEDREF+f+l.SEPARATOR):(f=c.slice(d+1),g=l.REVERSEDREF+f),a(l.chunks[f])&&(a(l.chunks[f].rData)&&(i=l.chunks[f].rData),b.newpathdata=c=c.replace(g,i),j=!0),h=c.slice(d+1).search(l.REVERSEDREF),d=-1!==h?d+1+h:-1;return j}function d(a,b){var c="M"+b.x+","+b.y+a,d=l.svg_parse_path(c),e=l.fullrelativePathCmdList(d);return e.cmd=e.cmd.slice(1),e}function e(a){var b=a.reverse();return b}function f(a){var b,c,d="";for(b=0;a.cmd.length>b;b+=1)switch(c=a.cmd[b],c.command){case"l":d+=c.command+c.target.x+","+c.target.y;break;case"c":d+=c.command+c.ctlpt1.x+","+c.ctlpt1.y+" "+c.ctlpt2.x+","+c.ctlpt2.y+" "+c.target.x+","+c.target.y;break;case"q":case"t":d+=c.command+c.ctlpt1.x+","+c.ctlpt1.y+" "+c.target.x+","+c.target.y}return d}function g(b){var c,g,h,i,j,k=b.getAttribute("d"),m=!1;b.chunks=[],h=b.cmdList=l.svg_parse_path(k),i=0;do j=h.cmd[i],j.command===l.OPENCHUNK&&a(j.crtPt)&&(c=j.chunkName,g=l.chunks[c]={},g.nam=c,g.description=d(j.strDescription,j.crtPt),g.reversedDescription=e(g.description),g.path=b,g.data=f(g.description),g.rData=f(g.reversedDescription),b.chunks.push(g),b.newpathdata=k.replace(k.slice(k.indexOf(l.OPENCHUNK),k.indexOf(l.ENDCHUNK)+1),g.data),m=!0),i+=1;while(h.cmd.length>i);return m}function h(b){var c="";return a(b.ctlpt1)&&(c+=b.ctlpt1.x+","+b.ctlpt1.y+" "),a(b.ctlpt2)&&(c+=b.ctlpt2.x+","+b.ctlpt2.y+" "),a(b.target)&&(c+=b.target.x+","+b.target.y),c}function i(a,b,c){var d=new l.Command(a),e=new l.Point(b,c);return d.crtPt=new l.Point(e.x,e.y),d.target=e,d}function j(a,b,c,d){var e,f,g,h=a.length;for(e=0;h>e;e+=1)f=a[e],g=f.getAttribute("d"),f.srcData=g,-1!==g.indexOf(l.OPENCHUNK)&&b.push(f),-1!==g.indexOf(l.DIRECTREF)&&c.push(f),-1!==g.indexOf(l.REVERSEDREF)&&d.push(f)}function k(a,b,c){for(var d,e=0,f=!1,g=!1;a.length>e;)d=a[e],g=b(d),g&&(d.setAttribute("d",d.newpathdata),-1===d.newpathdata.indexOf(c)&&a.splice(e,1),f=!0),e+=1;return f}var l={version:"0.1.4",SEPARATOR:"|",OPENCHUNK:"(",ENDCHUNK:")",DIRECTREF:"#",REVERSEDREF:"!"};l.chunks=[],l.TokensToString={h:function(){return this.command+this.d},v:function(){return this.command+this.d},H:function(){return this.command+this.d},V:function(){return this.command+this.d},z:function(){return this.command+h(this)},"default":function(){return this.command+h(this)}},l.TokensToString[l.OPENCHUNK]=function(){return this.command+this.chunkName+l.SEPARATOR+this.strDescription+l.ENDCHUNK},l.TokensToString[l.DIRECTREF]=function(){return this.command+this.ref+l.SEPARATOR},l.TokensToString[l.REVERSEDREF]=function(){return this.command+this.ref+l.SEPARATOR},l.Command=function(a){var b={};return b.command=a,b.toString=l.TokensToString[b.command]||l.TokensToString["default"],b};var m=function(a,b,c,d){var e=i(d,a.cmd[c].target.x,a.cmd[c].target.y);return e};l.cmdCreationRules={v:function(a,b,c,d){var e=i(d,b.cmd[c-1].crtPt.x,a.cmd[c].d);return e.d=e.target.y,e},V:function(a,b,c,d){var e=i(d,b.cmd[c-1].crtPt.x,a.cmd[c].d);return"V"===crtcmdcode&&(e.command="v",e.target.y-=b.cmd[c-1].crtPt.y),e.d=e.target.y,e},h:function(a,b,c,d){var e=i(d,a.cmd[c].d,b.cmd[c-1].crtPt.y);return e.d=e.target.x,e},H:function(a,b,c,d){var e=i(d,a.cmd[c].d,b.cmd[c-1].crtPt.y);return"H"===d&&(e.command="h",e.target.x-=b.cmd[c-1].crtPt.x),e.d=e.target.x,e},m:m,M:m,l:m,L:function(a,b,c,d){var e=i(d,a.cmd[c].target.x,a.cmd[c].target.y);return"L"===d&&(e.command="l",e.target.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y)),e},q:function(a,b,c,d){var e=i(d,a.cmd[c].target.x,a.cmd[c].target.y);return e.ctlpt1=new l.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),e},Q:function(a,b,c,d){var e=i(d,a.cmd[c].target.x,a.cmd[c].target.y);return e.ctlpt1=new l.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),("Q"===d||"T"===d)&&(e.command="Q"===d?"q":"t",e.ctlpt1.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y),e.target.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y)),e},c:function(a,b,c,d){var e=i(d,a.cmd[c].target.x,a.cmd[c].target.y);return e.ctlpt1=new l.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),e.ctlpt2=new l.Point(a.cmd[c].ctlpt2.x,a.cmd[c].ctlpt2.y),e},C:function(a,b,c,d){var e=i(d,a.cmd[c].target.x,a.cmd[c].target.y);return e.ctlpt1=new l.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),e.ctlpt2=new l.Point(a.cmd[c].ctlpt2.x,a.cmd[c].ctlpt2.y),"C"===d&&(e.command="c",e.ctlpt1.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y),e.ctlpt2.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y),e.target.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y)),e},z:function(a,b,c,d){var e=new l.Command("z");return e},"default":function(a,b,c,d){return null}},l.cmdCreationRules[l.OPENCHUNK]=function(a,b,c,d){var e=new l.Command(l.OPENCHUNK);return e.chunkName=a.cmd[c].chunkName,e.strDescription=a.cmd[c].strDescription,e},l.fullrelativePathCmdList=function(a){var b,c=new l.CmdList,d={},e=null,f=0,g=a.cmd.length;for(d.x=a.cmd[0].target.x,d.y=a.cmd[0].target.y;g>f;){b=a.cmd[f].command;var h=l.cmdCreationRules[b]||l.cmdCreationRules["default"];e=h(a,c,f,b),e&&(c.cmd.push(e),e=null),f+=1}return c},l.Point=function(a,b){this.x=a,this.y=b,this.translate=function(a,b){this.x+=a,this.y+=b}},l.CmdList=function(){this.cmd=[],this.getSubpathStartingPoint=function(b){var c,d=0;for(d=0;this.cmd.length>d+1;d+=1)if(c=this.cmd[d],c.command===l.OPENCHUNK&&c.chunkName===b&&a(c.crtPt))return c.crtPt;return null};var b=function(a,b,c){var d=new l.Point(-1*c.target.x,-1*c.target.y);b.target=d},c=function(a,b,c){var d=new l.Point(c.target.x,c.target.y);b.ctlpt1=new l.Point(c.ctlpt1.x-d.x,c.ctlpt1.y-d.y),b.target=new l.Point(-1*d.x,-1*d.y)};this.reverseRules={M:b,h:function(a,b,c){b.d=-1*c.d},v:function(a,b,c){b.d=-1*c.d},l:b,c:function(a,b,c){var d=new l.Point(c.target.x,c.target.y);b.ctlpt1=new l.Point(c.ctlpt2.x-d.x,c.ctlpt2.y-d.y),b.ctlpt2=new l.Point(c.ctlpt1.x-d.x,c.ctlpt1.y-d.y),b.target=new l.Point(-1*d.x,-1*d.y)},q:c,t:c},this.reverse=function(){var a,b,c=new l.CmdList;for(a=this.cmd.length-1;a>=0;a-=1){b=new l.Command(this.cmd[a].command);var d=this.reverseRules[b];d(a,b,this.cmd[a]),c.push(b)}return c},this.push=function(a){this.cmd.push(a)},this.toString=function(){for(var a=0,b="";this.cmd.length>a;)b+=this.cmd[a].toString(),a+=1;return b}};var n=function(a,b){var c=a.getAsCurrentPoint(a.isRelativeCommand()),d=new l.Command(a.command);for(d.target=c,d.absEndPt=c,b.push(d),a.start=a.current;!a.isCommandOrEnd();)c=a.getAsCurrentPoint(a.isRelativeCommand()),d=new l.Command("L"),d.target=c,d.absEndPt=new l.Point(c.x,c.y),b.push(d)},o=function(b,c){var d,e;do d=new l.Command(b.command),d.current=b.current,e=b.getAsCurrentPoint(b.isRelativeCommand()),d.target=e,d.absEndPt=new l.Point(e.x,e.y),b.isRelativeCommand(d.command)&&a(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!b.isCommandOrEnd())},p=function(b,c){var d,e,f;do d=new l.Command(b.command),d.current=b.current,e=b.getScalar(),f=new l.Point((b.isRelativeCommand()?b.current.x:0)+e,b.current.y),b.current=f,d.d=(b.isRelativeCommand()?b.current.x:0)+e,d.absEndPt=new l.Point(f.x,f.y),b.isRelativeCommand(d.command)&&a(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!b.isCommandOrEnd())},q=function(b,c){var d,e,f;do d=new l.Command(b.command),d.current=b.current,e=b.getScalar(),f=new l.Point(b.current.x,(b.isRelativeCommand()?b.current.y:0)+e),b.current=f,d.d=(b.isRelativeCommand()?b.current.x:0)+e,d.absEndPt=new l.Point(f.x,f.y),b.isRelativeCommand(d.command)&&a(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!b.isCommandOrEnd())},r=function(b,c){var d,e,f,g;do d=new l.Command(b.command),d.current=b.current,e=b.getAsControlPoint(b.isRelativeCommand()),f=b.getAsControlPoint(b.isRelativeCommand()),g=b.getAsCurrentPoint(b.isRelativeCommand()),d.ctlpt1=e,d.ctlpt2=f,d.target=g,d.absEndPt=new l.Point(g.x,g.y),b.isRelativeCommand(d.command)&&a(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!b.isCommandOrEnd())},s=function(a,b){},t=function(b,c){var d,e,f;do d=new l.Command(b.command),d.current=b.current,e=b.getAsControlPoint(b.isRelativeCommand()),f=b.getAsCurrentPoint(b.isRelativeCommand()),d.ctlpt1=e,d.target=f,d.absEndPt=new l.Point(f.x,f.y),b.isRelativeCommand(d.command)&&a(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!b.isCommandOrEnd())},u=function(b,c){var d,e,f;do d=new l.Command(b.command),d.current=b.current,f=b.getAsCurrentPoint(b.isRelativeCommand()),d.ctlpt1=e,d.target=f,d.absEndPt=new l.Point(f.x,f.y),b.isRelativeCommand(d.command)&&a(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!b.isCommandOrEnd())},v=function(a,b){},w=function(a,b){var c;do c=new l.Command(a.command),c.current=a.current,b.push(c);while(!a.isCommandOrEnd())};l.ParseToken={M:n,m:n,L:o,l:o,H:p,h:p,V:q,v:q,C:r,c:r,S:s,s:s,Q:t,q:t,T:u,t:u,A:v,Z:w,z:w},l.ParseToken[l.OPENCHUNK]=function(b,c){var d=new l.Command(b.command),e=b.getSubpathRefId(),f=b.getSubpathDesc();d.chunkName=e,d.strDescription=f,a(c.cmd[c.cmd.length-1].absEndPt)&&(d.crtPt=c.cmd[c.cmd.length-1].absEndPt),c.push(d)},l.ParseToken[l.REVERSEDREF]=l.ParseToken[l.DIRECTREF]=function(a,b){var c=new l.Command(a.command);c.ref=a.getSubpathRefId(),b.push(c)},l.svg_parse_path=function(a){var b,c,d=a,e=new l.CmdList;for(b=this.PathParser=new ExtendedPathParser(l,d,l.DIRECTREF,l.REVERSEDREF,l.OPENCHUNK,l.ENDCHUNK),b.reset();!b.isEnd();)b.nextCommand(),(c=l.ParseToken[b.command])(b,e);return e},l.expandPaths=function(){var a=document.getElementsByTagName("path"),d=[],e=[],f=[],h=!1;j(a,d,e,f);do h=!1,h|=k(d,g,l.OPENCHUNK),h|=k(e,b,l.DIRECTREF),h|=k(f,c,l.REVERSEDREF);while(h);(0!==d.length||0!==e.length||0!==f.length)&&(console.log("Problem: some chunk reference seems impossible to solve!"),0!==d.length&&console.log("Problem with"+d[0].toString()),0!==e.length&&console.log("Problem with reference"+e[0].toString()),0!==f.length&&console.log("Problem with inverse reference"+f[0].toString()))},"function"==typeof define&&define.amd?define(l):"object"==typeof module&&module.exports?module.exports=l:this.superpath=l}).call(this);