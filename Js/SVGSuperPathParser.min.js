(function(){"use strict";function a(a){var b="";do b+=a.getToken();while(-1===b.indexOf(k.SEPARATOR));for(;-1!==b.indexOf(" ");)b=b.replace(" ","");return b.slice(0,b.indexOf("|"))}function b(a){for(var b=a.getToken(),d=a.getToken();c(d)&&d!==k.ENDCHUNK;)b+=d+" ",d=a.getToken();return b}function c(a){return null!==a&&void 0!==a}function d(a,b){var c="M"+b.x+","+b.y+a,d=pathparser.svg_parse_path(c),e=pathparser.fullrelativePathCmdList(d);return e.totalVector=new pathparser.Point(d.cmd[d.cmd.length-1].absEndPt.x,d.cmd[d.cmd.length-1].absEndPt.y),e.totalVector.translate(-b.x,-b.y),e.cmd=e.cmd.slice(1),e}function e(a){var b=a.reverse();return b}function f(a){var b,c="";for(b=0;a.cmd.length>b;b+=1)c+=a.cmd[b].toString();return c}function g(a){var b,g,h,i,j,l=a.processedD=a.processedD?a.processedD:a.getAttribute("data-sp-d"),m=!1;a.chunks=[],h=a.cmdList=pathparser.svg_parse_path(l),i=0;do j=h.cmd[i],j.command===k.OPENCHUNK&&c(j.crtPt)&&(b=j.chunkName,g={},g.name=b,g.description=d(j.strDescription,j.crtPt),g.startingPt=j.current,g.reversedDescription=e(g.description),g.path=a,g.data=f(g.description),g.rData=f(g.reversedDescription),a.chunks.push(g),k.chunks[b]=g,a.newpathdata=l.replace(l.slice(l.indexOf(k.OPENCHUNK),l.indexOf(k.ENDCHUNK)+1),g.data),m=!0),i+=1;while(h.cmd.length>i);return m}function h(a,b,c){for(var d,e=0,f=!1,g=!1;a.length>e;)d=a[e],g=b(d),g&&(d.processedD=d.newpathdata,-1===d.newpathdata.indexOf(c)&&a.splice(e,1),d.newpathdata="",f=!0),e+=1;return f}function i(a){for(var b=0;a.length>b;){var c=a[b].getAttribute("data-sp-d");null!==c&&(a[b].processedD=c),b+=1}}function j(a,b,c){console.log("Problem: some chunk reference seems impossible to solve!"),0!==a.length&&console.log("Problem with "+a[0].chunks),0!==b.length&&console.log("Problem with reference "+b[0].chunks),0!==c.length&&console.log("Problem with inverse reference "+c[0].chunks)}var k={version:"0.2.14",SEPARATOR:"|",OPENCHUNK:"(",ENDCHUNK:")",DIRECTREF:"#",REVERSEDREF:"!"};k.ParseToken={},k.observer=new MutationObserver(function(a){a.forEach(function(a){"attributes"===a.type&&"data-sp-d"===a.attributeName&&(a.target.processedD=a.target.getAttribute("data-sp-d"),k.expandPaths())})});var l={attributes:!0,childList:!1,characterData:!0};k.ParseToken[k.OPENCHUNK]=function(d,e){var f=new pathparser.Command(d.command),g=a(d),h=b(d);f.chunkName=g,f.strDescription=h,f.current=d.current,c(e.cmd[e.cmd.length-1].absEndPt)&&(f.crtPt=e.cmd[e.cmd.length-1].absEndPt),e.push(f)},k.ParseToken[k.REVERSEDREF]=k.ParseToken[k.DIRECTREF]=function(b,d){var e=new pathparser.Command(b.command);e.ref=a(b),e.current=b.current,c(d.cmd[d.cmd.length-1].absEndPt)&&(e.crtPt=d.cmd[d.cmd.length-1].absEndPt),d.push(e)},k.ParseToken[k.ENDCHUNK]=function(a,b){},k.chunks=[],k.expandChunks=function(a){var b,d,e,f,g,h,i="",j=!1;for(b=a.processedD,d=b.search(k.DIRECTREF);d>0;)e=b.indexOf(k.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=k.DIRECTREF+f+k.SEPARATOR,c(k.chunks[f])&&(i=k.chunks[f].data+" ",a.newpathdata=b=b.replace(g,i),j=!0)):(f=b.slice(d+1),g=k.DIRECTREF+f,c(k.chunks[f])&&(i=k.chunks[f].data,a.newpathdata=b=b.replace(g,i),j=!0)),i="",h=b.slice(d+1).search(k.DIRECTREF),d=-1!==h?d+1+h:-1;return j},k.expandReversedChunks=function(a){var b,d,e,f,g,h,i,j=!1;for(b=a.processedD,d=b.search(k.REVERSEDREF);d>0;)e=b.indexOf(k.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=k.REVERSEDREF+f+k.SEPARATOR):(f=b.slice(d+1),g=k.REVERSEDREF+f),c(k.chunks[f])&&(c(k.chunks[f].rData)&&(i=k.chunks[f].rData),a.newpathdata=b=b.replace(g,i),j=!0),h=b.slice(d+1).search(k.REVERSEDREF),d=-1!==h?d+1+h:-1;return j},k.TokensToString={},k.TokensToString[k.OPENCHUNK]=function(){return this.command+this.chunkName+k.SEPARATOR+this.strDescription+k.ENDCHUNK},k.TokensToString[k.DIRECTREF]=function(){return this.command+this.ref+k.SEPARATOR},k.TokensToString[k.REVERSEDREF]=function(){return this.command+this.ref+k.SEPARATOR},k.getSubpathStartingPoint=function(a,b){var d,e=0;for(e=0;a.cmd.length>e+1;e+=1)if(d=a.cmd[e],d.command===k.OPENCHUNK&&d.chunkName===b&&c(d.crtPt))return d.crtPt;return null},k.cmdCreationRules={},k.cmdCreationRules[k.OPENCHUNK]=function(a,b,c,d){var e=new pathparser.Command(k.OPENCHUNK);return e.chunkName=a.cmd[c].chunkName,e.strDescription=a.cmd[c].strDescription,e},k.buildTablesOfPathUsingChunk=function(a,b,d,e){var f,g,h,i=a.length;for(f=0;i>f;f+=1)g=a[f],h=g.processedD,c(h)&&(-1!==h.indexOf(k.OPENCHUNK)&&b.push(g),-1!==h.indexOf(k.DIRECTREF)&&d.push(g),-1!==h.indexOf(k.REVERSEDREF)&&e.push(g))},k.searchPathDefiner=function(a){var b=null;return k.chunks[a]?k.chunks[a].path:b},k.expandPaths=function(){var a=document.getElementsByTagName("path"),b=[],d=[],e=[],f=!1;k.observer.disconnect();var m=0;i(a),k.chunks=[],pathparser.addCommands(k.ParseToken),pathparser.addCmdCreationRules(k.cmdCreationRules),pathparser.addStringifier(k.TokensToString),k.buildTablesOfPathUsingChunk(a,b,d,e);do f=!1,f|=h(b,g,k.OPENCHUNK),f|=h(d,k.expandChunks,k.DIRECTREF),f|=h(e,k.expandReversedChunks,k.REVERSEDREF);while(f);for((0!==b.length||0!==d.length||0!==e.length)&&j(b,d,e),m=0;a.length>m;)c(a[m].processedD)&&a[m].setAttribute("d",a[m].processedD),k.observer.observe(a[m],l),m+=1},"function"==typeof define&&define.amd?define(k):"object"==typeof module&&module.exports?module.exports=k:this.superpath=k}).call(this);