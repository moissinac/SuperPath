(function(){"use strict";function a(a){var b="";do b+=a.getToken();while(-1===b.indexOf(j.SEPARATOR));for(;-1!==b.indexOf(" ");)b=b.replace(" ","");return b.slice(0,b.indexOf("|"))}function b(a){for(var b=a.getToken(),d=a.getToken();c(d)&&d!==j.ENDCHUNK;)b+=d+" ",d=a.getToken();return b}function c(a){return null!==a&&void 0!==a}function d(a,b){var c="M"+b.x+","+b.y+a,d=pathparser.svg_parse_path(c),e=pathparser.fullrelativePathCmdList(d);return e.totalVector=new pathparser.Point(d.cmd[d.cmd.length-1].absEndPt.x,d.cmd[d.cmd.length-1].absEndPt.y),e.totalVector.translate(-b.x,-b.y),e.cmd=e.cmd.slice(1),e}function e(a){var b=a.reverse();return b}function f(a){var b,c="";for(b=0;a.cmd.length>b;b+=1)c+=a.cmd[b].toString();return c}function g(a){var b,g,h,i,k,l=a.originalD=a.originalD?a.originalD:a.getAttribute("d"),m=!1;a.chunks=[],h=a.cmdList=pathparser.svg_parse_path(l),i=0;do k=h.cmd[i],k.command===j.OPENCHUNK&&c(k.crtPt)&&(b=k.chunkName,g={},g.name=b,g.description=d(k.strDescription,k.crtPt),console.log(b+" delta (x="+g.description.totalVector.x+", y="+g.description.totalVector.y+")"),g.startingPt=k.current,g.reversedDescription=e(g.description),g.path=a,g.data=f(g.description),g.rData=f(g.reversedDescription),a.chunks.push(g),j.chunks[b]=g,a.newpathdata=l.replace(l.slice(l.indexOf(j.OPENCHUNK),l.indexOf(j.ENDCHUNK)+1),g.data),m=!0),i+=1;while(h.cmd.length>i);return m}function h(a,b,c){for(var d,e=0,f=!1,g=!1;a.length>e;)d=a[e],g=b(d),g&&(d.setAttribute("d",d.newpathdata),-1===d.newpathdata.indexOf(c)&&a.splice(e,1),f=!0),e+=1;return f}function i(a){for(var b=0;a.length>b;)a[b].originalD?a[b].setAttribute("d",a[b].originalD):a[b].originalD=a[b].getAttribute("d"),b+=1}var j={version:"0.2.13",SEPARATOR:"|",OPENCHUNK:"(",ENDCHUNK:")",DIRECTREF:"#",REVERSEDREF:"!"};j.ParseToken={},j.observer=new MutationObserver(function(a){a.forEach(function(a){"attributes"===a.type&&"d"===a.attributeName&&(console.log("mutation target: "+a.target.originalD),a.target.originalD=a.target.getAttribute("d"),j.expandPaths())})});var k={attributes:!0,childList:!1,characterData:!0};j.ParseToken[j.OPENCHUNK]=function(d,e){var f=new pathparser.Command(d.command),g=a(d),h=b(d);f.chunkName=g,f.strDescription=h,f.current=d.current,c(e.cmd[e.cmd.length-1].absEndPt)&&(f.crtPt=e.cmd[e.cmd.length-1].absEndPt),e.push(f)},j.ParseToken[j.REVERSEDREF]=j.ParseToken[j.DIRECTREF]=function(b,d){var e=new pathparser.Command(b.command);e.ref=a(b),e.current=b.current,c(d.cmd[d.cmd.length-1].absEndPt)&&(e.crtPt=d.cmd[d.cmd.length-1].absEndPt),d.push(e)},j.ParseToken[j.ENDCHUNK]=function(a,b){},j.chunks=[],j.expandChunks=function(a){var b,d,e,f,g,h,i="",k=!1;for(b=a.getAttribute("d"),d=b.search(j.DIRECTREF);d>0;)e=b.indexOf(j.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=j.DIRECTREF+f+j.SEPARATOR,c(j.chunks[f])&&(i=j.chunks[f].data+" ",a.newpathdata=b=b.replace(g,i),k=!0)):(f=b.slice(d+1),g=j.DIRECTREF+f,c(j.chunks[f])&&(i=j.chunks[f].data,a.newpathdata=b=b.replace(g,i),k=!0)),i="",h=b.slice(d+1).search(j.DIRECTREF),d=-1!==h?d+1+h:-1;return k},j.expandReversedChunks=function(a){var b,d,e,f,g,h,i,k=!1;for(b=a.getAttribute("d"),d=b.search(j.REVERSEDREF);d>0;)e=b.indexOf(j.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=j.REVERSEDREF+f+j.SEPARATOR):(f=b.slice(d+1),g=j.REVERSEDREF+f),c(j.chunks[f])&&(c(j.chunks[f].rData)&&(i=j.chunks[f].rData),a.newpathdata=b=b.replace(g,i),k=!0),h=b.slice(d+1).search(j.REVERSEDREF),d=-1!==h?d+1+h:-1;return k},j.TokensToString={},j.TokensToString[j.OPENCHUNK]=function(){return this.command+this.chunkName+j.SEPARATOR+this.strDescription+j.ENDCHUNK},j.TokensToString[j.DIRECTREF]=function(){return this.command+this.ref+j.SEPARATOR},j.TokensToString[j.REVERSEDREF]=function(){return this.command+this.ref+j.SEPARATOR},j.getSubpathStartingPoint=function(a,b){var d,e=0;for(e=0;a.cmd.length>e+1;e+=1)if(d=a.cmd[e],d.command===j.OPENCHUNK&&d.chunkName===b&&c(d.crtPt))return d.crtPt;return null},j.cmdCreationRules={},j.cmdCreationRules[j.OPENCHUNK]=function(a,b,c,d){var e=new pathparser.Command(j.OPENCHUNK);return e.chunkName=a.cmd[c].chunkName,e.strDescription=a.cmd[c].strDescription,e},j.buildTablesOfPathUsingChunk=function(a,b,c,d){var e,f,g,h=a.length;for(e=0;h>e;e+=1)f=a[e],g=f.originalD,f.srcData=g,-1!==g.indexOf(j.OPENCHUNK)&&b.push(f),-1!==g.indexOf(j.DIRECTREF)&&c.push(f),-1!==g.indexOf(j.REVERSEDREF)&&d.push(f)},j.searchPathDefiner=function(a){var b=null;return j.chunks[a]?j.chunks[a].path:b},j.getOriginalD=function(a){},j.expandPaths=function(){var a=document.getElementsByTagName("path"),b=[],c=[],d=[],e=!1;j.observer.disconnect();var f=0;i(a),pathparser.addCommands(j.ParseToken),pathparser.addCmdCreationRules(j.cmdCreationRules),pathparser.addStringifier(j.TokensToString),j.buildTablesOfPathUsingChunk(a,b,c,d);do e=!1,e|=h(b,g,j.OPENCHUNK),e|=h(c,j.expandChunks,j.DIRECTREF),e|=h(d,j.expandReversedChunks,j.REVERSEDREF);while(e);for((0!==b.length||0!==c.length||0!==d.length)&&(console.log("Problem: some chunk reference seems impossible to solve!"),0!==b.length&&console.log("Problem with "+b[0].chunks),0!==c.length&&console.log("Problem with reference "+c[0].chunks),0!==d.length&&console.log("Problem with inverse reference "+d[0].chunks)),f=0;a.length>f;)j.observer.observe(a[f],k),f+=1},"function"==typeof define&&define.amd?define(j):"object"==typeof module&&module.exports?module.exports=j:this.superpath=j}).call(this);