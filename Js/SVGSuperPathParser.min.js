(function(){"use strict";function a(a){var b="";do b+=a.getToken();while(-1===b.indexOf(l.SEPARATOR));for(;-1!==b.indexOf(" ");)b=b.replace(" ","");return b.slice(0,b.indexOf("|"))}function b(a){for(var b=a.getToken(),d=a.getToken();c(d)&&d!==l.ENDCHUNK;)b+=d+" ",d=a.getToken();return b}function c(a){return null!==a&&void 0!==a}function d(a){var b,d,e,f,g,h,i="",j=!1;for(b=a.getAttribute("d"),d=b.search(l.DIRECTREF);d>0;)e=b.indexOf(l.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=l.DIRECTREF+f+l.SEPARATOR,c(l.chunks[f])&&(i=l.chunks[f].data+" ",a.newpathdata=b=b.replace(g,i),j=!0)):(f=b.slice(d+1),g=l.DIRECTREF+f,c(l.chunks[f])&&(i=l.chunks[f].data,a.newpathdata=b=b.replace(g,i),j=!0)),i="",h=b.slice(d+1).search(l.DIRECTREF),d=-1!==h?d+1+h:-1;return j}function e(a){var b,d,e,f,g,h,i,j=!1;for(b=a.getAttribute("d"),d=b.search(l.REVERSEDREF);d>0;)e=b.indexOf(l.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=l.REVERSEDREF+f+l.SEPARATOR):(f=b.slice(d+1),g=l.REVERSEDREF+f),c(l.chunks[f])&&(c(l.chunks[f].rData)&&(i=l.chunks[f].rData),a.newpathdata=b=b.replace(g,i),j=!0),h=b.slice(d+1).search(l.REVERSEDREF),d=-1!==h?d+1+h:-1;return j}function f(a,b){var c="M"+b.x+","+b.y+a,d=pathparser.svg_parse_path(c),e=pathparser.fullrelativePathCmdList(d);return e.cmd=e.cmd.slice(1),e}function g(a){var b=a.reverse();return b}function h(a){var b,c="";for(b=0;a.cmd.length>b;b+=1)c+=a.cmd[b].toString();return c}function i(a){var b,d,e,i,j,k=a.getAttribute("d"),m=!1;a.chunks=[],e=a.cmdList=pathparser.svg_parse_path(k),i=0;do j=e.cmd[i],j.command===l.OPENCHUNK&&c(j.crtPt)&&(b=j.chunkName,d=l.chunks[b]={},d.name=b,d.description=f(j.strDescription,j.crtPt),d.reversedDescription=g(d.description),d.path=a,d.data=h(d.description),d.rData=h(d.reversedDescription),a.chunks.push(d),a.newpathdata=k.replace(k.slice(k.indexOf(l.OPENCHUNK),k.indexOf(l.ENDCHUNK)+1),d.data),m=!0),i+=1;while(e.cmd.length>i);return m}function j(a,b,c,d){var e,f,g,h=a.length;for(e=0;h>e;e+=1)f=a[e],g=f.getAttribute("d"),f.srcData=g,-1!==g.indexOf(l.OPENCHUNK)&&b.push(f),-1!==g.indexOf(l.DIRECTREF)&&c.push(f),-1!==g.indexOf(l.REVERSEDREF)&&d.push(f)}function k(a,b,c){for(var d,e=0,f=!1,g=!1;a.length>e;)d=a[e],g=b(d),g&&(d.setAttribute("d",d.newpathdata),-1===d.newpathdata.indexOf(c)&&a.splice(e,1),f=!0),e+=1;return f}var l={version:"0.2.10",SEPARATOR:"|",OPENCHUNK:"(",ENDCHUNK:")",DIRECTREF:"#",REVERSEDREF:"!"};l.ParseToken={},l.ParseToken[l.OPENCHUNK]=function(d,e){var f=new pathparser.Command(d.command),g=a(d),h=b(d);f.chunkName=g,f.strDescription=h,c(e.cmd[e.cmd.length-1].absEndPt)&&(f.crtPt=e.cmd[e.cmd.length-1].absEndPt),e.push(f)},l.ParseToken[l.REVERSEDREF]=l.ParseToken[l.DIRECTREF]=function(b,c){var d=new pathparser.Command(b.command);d.ref=a(b),c.push(d)},l.ParseToken[l.ENDCHUNK]=function(a,b){},l.chunks=[],l.TokensToString={},l.TokensToString[l.OPENCHUNK]=function(){return this.command+this.chunkName+l.SEPARATOR+this.strDescription+l.ENDCHUNK},l.TokensToString[l.DIRECTREF]=function(){return this.command+this.ref+l.SEPARATOR},l.TokensToString[l.REVERSEDREF]=function(){return this.command+this.ref+l.SEPARATOR},l.getSubpathStartingPoint=function(a,b){var d,e=0;for(e=0;a.cmd.length>e+1;e+=1)if(d=a.cmd[e],d.command===l.OPENCHUNK&&d.chunkName===b&&c(d.crtPt))return d.crtPt;return null},l.cmdCreationRules={},l.cmdCreationRules[l.OPENCHUNK]=function(a,b,c,d){var e=new pathparser.Command(l.OPENCHUNK);return e.chunkName=a.cmd[c].chunkName,e.strDescription=a.cmd[c].strDescription,e},l.expandPaths=function(){var a=document.getElementsByTagName("path"),b=[],c=[],f=[],g=!1;pathparser.addCommands(l.ParseToken),pathparser.addCmdCreationRules(l.cmdCreationRules),pathparser.addStringifier(l.TokensToString),j(a,b,c,f);do g=!1,g|=k(b,i,l.OPENCHUNK),g|=k(c,d,l.DIRECTREF),g|=k(f,e,l.REVERSEDREF);while(g);(0!==b.length||0!==c.length||0!==f.length)&&(console.log("Problem: some chunk reference seems impossible to solve!"),0!==b.length&&console.log("Problem with"+b[0].toString()),0!==c.length&&console.log("Problem with reference"+c[0].toString()),0!==f.length&&console.log("Problem with inverse reference"+f[0].toString()))},"function"==typeof define&&define.amd?define(l):"object"==typeof module&&module.exports?module.exports=l:this.superpath=l}).call(this);