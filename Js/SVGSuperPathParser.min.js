(function(){"use strict";function a(a){var b="";do b+=a.getToken();while(-1===b.indexOf(i.SEPARATOR));for(;-1!==b.indexOf(" ");)b=b.replace(" ","");return b.slice(0,b.indexOf("|"))}function b(a){for(var b=a.getToken(),d=a.getToken();c(d)&&d!==i.ENDCHUNK;)b+=d+" ",d=a.getToken();return b}function c(a){return null!==a&&void 0!==a}function d(a,b){var c="M"+b.x+","+b.y+a,d=pathparser.svg_parse_path(c),e=pathparser.fullrelativePathCmdList(d);return e.totalVector=new pathparser.Point(d.cmd[d.cmd.length-1].absEndPt.x,d.cmd[d.cmd.length-1].absEndPt.y),e.totalVector.translate(-b.x,-b.y),e.cmd=e.cmd.slice(1),e}function e(a){var b=a.reverse();return b}function f(a){var b,c="";for(b=0;a.cmd.length>b;b+=1)c+=a.cmd[b].toString();return c}function g(a){var b,g,h,j,k,l=a.originalD=a.originalD?a.originalD:a.getAttribute("d"),m=!1;a.chunks=[],h=a.cmdList=pathparser.svg_parse_path(l),j=0;do k=h.cmd[j],k.command===i.OPENCHUNK&&c(k.crtPt)&&(b=k.chunkName,g={},g.name=b,g.description=d(k.strDescription,k.crtPt),console.log(b+" delta (x="+g.description.totalVector.x+", y="+g.description.totalVector.y+")"),g.startingPt=k.current,g.reversedDescription=e(g.description),g.path=a,g.data=f(g.description),g.rData=f(g.reversedDescription),a.chunks.push(g),i.chunks[b]=g,a.newpathdata=l.replace(l.slice(l.indexOf(i.OPENCHUNK),l.indexOf(i.ENDCHUNK)+1),g.data),m=!0),j+=1;while(h.cmd.length>j);return m}function h(a,b,c){for(var d,e=0,f=!1,g=!1;a.length>e;)d=a[e],g=b(d),g&&(d.setAttribute("d",d.newpathdata),-1===d.newpathdata.indexOf(c)&&a.splice(e,1),f=!0),e+=1;return f}var i={version:"0.2.11",SEPARATOR:"|",OPENCHUNK:"(",ENDCHUNK:")",DIRECTREF:"#",REVERSEDREF:"!"};i.ParseToken={},i.observer=new MutationObserver(function(a){a.forEach(function(a){"attributes"===a.type&&"d"===a.attributeName&&(console.log("mutation target: "+a.target.originalD),a.target.originalD=a.target.getAttribute("d"),i.expandPaths())})});var j={attributes:!0,childList:!1,characterData:!0};i.ParseToken[i.OPENCHUNK]=function(d,e){var f=new pathparser.Command(d.command),g=a(d),h=b(d);f.chunkName=g,f.strDescription=h,f.current=d.current,c(e.cmd[e.cmd.length-1].absEndPt)&&(f.crtPt=e.cmd[e.cmd.length-1].absEndPt),e.push(f)},i.ParseToken[i.REVERSEDREF]=i.ParseToken[i.DIRECTREF]=function(b,d){var e=new pathparser.Command(b.command);e.ref=a(b),e.current=b.current,c(d.cmd[d.cmd.length-1].absEndPt)&&(e.crtPt=d.cmd[d.cmd.length-1].absEndPt),d.push(e)},i.ParseToken[i.ENDCHUNK]=function(a,b){},i.chunks=[],i.expandChunks=function(a){var b,d,e,f,g,h,j="",k=!1;for(b=a.getAttribute("d"),d=b.search(i.DIRECTREF);d>0;)e=b.indexOf(i.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=i.DIRECTREF+f+i.SEPARATOR,c(i.chunks[f])&&(j=i.chunks[f].data+" ",a.newpathdata=b=b.replace(g,j),k=!0)):(f=b.slice(d+1),g=i.DIRECTREF+f,c(i.chunks[f])&&(j=i.chunks[f].data,a.newpathdata=b=b.replace(g,j),k=!0)),j="",h=b.slice(d+1).search(i.DIRECTREF),d=-1!==h?d+1+h:-1;return k},i.expandReversedChunks=function(a){var b,d,e,f,g,h,j,k=!1;for(b=a.getAttribute("d"),d=b.search(i.REVERSEDREF);d>0;)e=b.indexOf(i.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=i.REVERSEDREF+f+i.SEPARATOR):(f=b.slice(d+1),g=i.REVERSEDREF+f),c(i.chunks[f])&&(c(i.chunks[f].rData)&&(j=i.chunks[f].rData),a.newpathdata=b=b.replace(g,j),k=!0),h=b.slice(d+1).search(i.REVERSEDREF),d=-1!==h?d+1+h:-1;return k},i.TokensToString={},i.TokensToString[i.OPENCHUNK]=function(){return this.command+this.chunkName+i.SEPARATOR+this.strDescription+i.ENDCHUNK},i.TokensToString[i.DIRECTREF]=function(){return this.command+this.ref+i.SEPARATOR},i.TokensToString[i.REVERSEDREF]=function(){return this.command+this.ref+i.SEPARATOR},i.getSubpathStartingPoint=function(a,b){var d,e=0;for(e=0;a.cmd.length>e+1;e+=1)if(d=a.cmd[e],d.command===i.OPENCHUNK&&d.chunkName===b&&c(d.crtPt))return d.crtPt;return null},i.cmdCreationRules={},i.cmdCreationRules[i.OPENCHUNK]=function(a,b,c,d){var e=new pathparser.Command(i.OPENCHUNK);return e.chunkName=a.cmd[c].chunkName,e.strDescription=a.cmd[c].strDescription,e},i.buildTablesOfPathUsingChunk=function(a,b,c,d){var e,f,g,h=a.length;for(e=0;h>e;e+=1)f=a[e],g=f.originalD,f.srcData=g,-1!==g.indexOf(i.OPENCHUNK)&&b.push(f),-1!==g.indexOf(i.DIRECTREF)&&c.push(f),-1!==g.indexOf(i.REVERSEDREF)&&d.push(f)},i.searchPathDefiner=function(a){var b=null;return i.chunks[a]?i.chunks[a].path:b},i.getOriginalD=function(a){},i.buildTablesOfPathUsingNamedChunk=function(a,b,c,d,e){var f,g,h,j,k=b.length,l=a.length;for(f=0;l>f;f+=1)h=a[f],h.originalD=j=h.originalD?h.originalD:h.getAttribute("d"),h.srcData=j,-1!==j.indexOf(i.OPENCHUNK+b)&&j[g+k+1]===i.SEPARATOR&&c.push(h),-1!==(g=j.indexOf(i.DIRECTREF+b))&&(j[g+k+1]===i.SEPARATOR||g+k+1===j.length)&&d.push(h),-1!==(g=j.indexOf(i.REVERSEDREF+b))&&(j[g+k+1]===i.SEPARATOR||g+k+1===j.length)&&e.push(h)},i.expandPaths=function(){var a=document.getElementsByTagName("path"),b=[],c=[],d=[],e=!1;i.observer.disconnect();for(var f=0;a.length>f;)a[f].originalD=a[f].originalD?a[f].originalD:a[f].getAttribute("d"),a[f].setAttribute("d",a[f].originalD),f+=1;pathparser.addCommands(i.ParseToken),pathparser.addCmdCreationRules(i.cmdCreationRules),pathparser.addStringifier(i.TokensToString),i.buildTablesOfPathUsingChunk(a,b,c,d);do e=!1,e|=h(b,g,i.OPENCHUNK),e|=h(c,i.expandChunks,i.DIRECTREF),e|=h(d,i.expandReversedChunks,i.REVERSEDREF);while(e);(0!==b.length||0!==c.length||0!==d.length)&&(console.log("Problem: some chunk reference seems impossible to solve!"),0!==b.length&&console.log("Problem with "+b[0].chunks),0!==c.length&&console.log("Problem with reference "+c[0].chunks),0!==d.length&&console.log("Problem with inverse reference "+d[0].chunks));for(var f=0;a.length>f;)i.observer.observe(a[f],j),f+=1},"function"==typeof define&&define.amd?define(i):"object"==typeof module&&module.exports?module.exports=i:this.superpath=i}).call(this);