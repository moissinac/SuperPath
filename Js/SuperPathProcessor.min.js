(function(){"use strict";function a(a){var b="";do b+=a.getToken();while(-1===b.indexOf(n.SEPARATOR));for(;-1!==b.indexOf(" ");)b=b.replace(" ","");return b.slice(0,b.indexOf("|"))}function b(a){for(var b=a.getToken(),d=a.getToken();c(d)&&d!==n.ENDCHUNK;)b+=d+" ",d=a.getToken();return b}function c(a){return null!==a&&void 0!==a}function d(a){var b,d,e,f,g,h,i="",j=!1;for(b=a.getAttribute("d"),d=b.search(n.DIRECTREF);d>0;)e=b.indexOf(n.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=n.DIRECTREF+f+n.SEPARATOR,c(n.chunks[f])&&(i=n.chunks[f].data+" ",a.newpathdata=b=b.replace(g,i),j=!0)):(f=b.slice(d+1),g=n.DIRECTREF+f,c(n.chunks[f])&&(i=n.chunks[f].data,a.newpathdata=b=b.replace(g,i),j=!0)),i="",h=b.slice(d+1).search(n.DIRECTREF),d=-1!==h?d+1+h:-1;return j}function e(a){var b,d,e,f,g,h,i,j=!1;for(b=a.getAttribute("d"),d=b.search(n.REVERSEDREF);d>0;)e=b.indexOf(n.SEPARATOR,d+1),-1!==e?(f=b.slice(d+1,e),g=n.REVERSEDREF+f+n.SEPARATOR):(f=b.slice(d+1),g=n.REVERSEDREF+f),c(n.chunks[f])&&(c(n.chunks[f].rData)&&(i=n.chunks[f].rData),a.newpathdata=b=b.replace(g,i),j=!0),h=b.slice(d+1).search(n.REVERSEDREF),d=-1!==h?d+1+h:-1;return j}function f(a,b){var c="M"+b.x+","+b.y+a,d=pathparser.svg_parse_path(c),e=pathparser.fullrelativePathCmdList(d);return e.cmd=e.cmd.slice(1),e}function g(a){var b=a.reverse();return b}function h(a){var b,c,d="";for(b=0;a.cmd.length>b;b+=1)switch(c=a.cmd[b],c.command){case"l":d+=c.command+c.target.x+","+c.target.y;break;case"c":d+=c.command+c.ctlpt1.x+","+c.ctlpt1.y+" "+c.ctlpt2.x+","+c.ctlpt2.y+" "+c.target.x+","+c.target.y;break;case"q":case"t":d+=c.command+c.ctlpt1.x+","+c.ctlpt1.y+" "+c.target.x+","+c.target.y}return d}function i(a){var b,d,e,i,j,k=a.getAttribute("d"),l=!1;a.chunks=[],e=a.cmdList=pathparser.svg_parse_path(k),i=0;do j=e.cmd[i],j.command===n.OPENCHUNK&&c(j.crtPt)&&(b=j.chunkName,d=n.chunks[b]={},d.nam=b,d.description=f(j.strDescription,j.crtPt),d.reversedDescription=g(d.description),d.path=a,d.data=h(d.description),d.rData=h(d.reversedDescription),a.chunks.push(d),a.newpathdata=k.replace(k.slice(k.indexOf(n.OPENCHUNK),k.indexOf(n.ENDCHUNK)+1),d.data),l=!0),i+=1;while(e.cmd.length>i);return l}function j(a){var b="";return c(a.ctlpt1)&&(b+=a.ctlpt1.x+","+a.ctlpt1.y+" "),c(a.ctlpt2)&&(b+=a.ctlpt2.x+","+a.ctlpt2.y+" "),c(a.target)&&(b+=a.target.x+","+a.target.y),b}function k(a,b,c){var d=new n.Command(a),e=new n.Point(b,c);return d.crtPt=new n.Point(e.x,e.y),d.target=e,d}function l(a,b,c,d){var e,f,g,h=a.length;for(e=0;h>e;e+=1)f=a[e],g=f.getAttribute("d"),f.srcData=g,-1!==g.indexOf(n.OPENCHUNK)&&b.push(f),-1!==g.indexOf(n.DIRECTREF)&&c.push(f),-1!==g.indexOf(n.REVERSEDREF)&&d.push(f)}function m(a,b,c){for(var d,e=0,f=!1,g=!1;a.length>e;)d=a[e],g=b(d),g&&(d.setAttribute("d",d.newpathdata),-1===d.newpathdata.indexOf(c)&&a.splice(e,1),f=!0),e+=1;return f}var n={version:"0.1.4",SEPARATOR:"|",OPENCHUNK:"(",ENDCHUNK:")",DIRECTREF:"#",REVERSEDREF:"!"};n.ParseToken={},n.ParseToken[n.OPENCHUNK]=function(d,e){var f=new n.Command(d.command),g=a(d),h=b(d);f.chunkName=g,f.strDescription=h,c(e.cmd[e.cmd.length-1].absEndPt)&&(f.crtPt=e.cmd[e.cmd.length-1].absEndPt),e.push(f)},n.ParseToken[n.REVERSEDREF]=n.ParseToken[n.DIRECTREF]=function(b,c){var d=new n.Command(b.command);d.ref=a(b),c.push(d)},n.ParseToken[n.ENDCHUNK]=function(a,b){},n.chunks=[],n.TokensToString={h:function(){return this.command+this.d},v:function(){return this.command+this.d},H:function(){return this.command+this.d},V:function(){return this.command+this.d},z:function(){return this.command+j(this)},"default":function(){return this.command+j(this)}},n.TokensToString[n.OPENCHUNK]=function(){return this.command+this.chunkName+n.SEPARATOR+this.strDescription+n.ENDCHUNK},n.TokensToString[n.DIRECTREF]=function(){return this.command+this.ref+n.SEPARATOR},n.TokensToString[n.REVERSEDREF]=function(){return this.command+this.ref+n.SEPARATOR},n.Command=function(a){var b={};return b.command=a,b.toString=n.TokensToString[b.command]||n.TokensToString["default"],b};var o=function(a,b,c,d){var e=k(d,a.cmd[c].target.x,a.cmd[c].target.y);return e};n.cmdCreationRules={v:function(a,b,c,d){var e=k(d,b.cmd[c-1].crtPt.x,a.cmd[c].d);return e.d=e.target.y,e},V:function(a,b,c,d){var e=k(d,b.cmd[c-1].crtPt.x,a.cmd[c].d);return"V"===crtcmdcode&&(e.command="v",e.target.y-=b.cmd[c-1].crtPt.y),e.d=e.target.y,e},h:function(a,b,c,d){var e=k(d,a.cmd[c].d,b.cmd[c-1].crtPt.y);return e.d=e.target.x,e},H:function(a,b,c,d){var e=k(d,a.cmd[c].d,b.cmd[c-1].crtPt.y);return"H"===d&&(e.command="h",e.target.x-=b.cmd[c-1].crtPt.x),e.d=e.target.x,e},m:o,M:o,l:o,L:function(a,b,c,d){var e=k(d,a.cmd[c].target.x,a.cmd[c].target.y);return"L"===d&&(e.command="l",e.target.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y)),e},q:function(a,b,c,d){var e=k(d,a.cmd[c].target.x,a.cmd[c].target.y);return e.ctlpt1=new n.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),e},Q:function(a,b,c,d){var e=k(d,a.cmd[c].target.x,a.cmd[c].target.y);return e.ctlpt1=new n.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),("Q"===d||"T"===d)&&(e.command="Q"===d?"q":"t",e.ctlpt1.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y),e.target.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y)),e},c:function(a,b,c,d){var e=k(d,a.cmd[c].target.x,a.cmd[c].target.y);return e.ctlpt1=new n.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),e.ctlpt2=new n.Point(a.cmd[c].ctlpt2.x,a.cmd[c].ctlpt2.y),e},C:function(a,b,c,d){var e=k(d,a.cmd[c].target.x,a.cmd[c].target.y);return e.ctlpt1=new n.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),e.ctlpt2=new n.Point(a.cmd[c].ctlpt2.x,a.cmd[c].ctlpt2.y),"C"===d&&(e.command="c",e.ctlpt1.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y),e.ctlpt2.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y),e.target.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y)),e},z:function(a,b,c,d){var e=new n.Command("z");return e},"default":function(a,b,c,d){return null}},n.cmdCreationRules[n.OPENCHUNK]=function(a,b,c,d){var e=new n.Command(n.OPENCHUNK);return e.chunkName=a.cmd[c].chunkName,e.strDescription=a.cmd[c].strDescription,e},n.Point=function(a,b){this.x=a,this.y=b,this.translate=function(a,b){this.x+=a,this.y+=b}},n.getSubpathStartingPoint=function(a,b){var d,e=0;for(e=0;a.cmd.length>e+1;e+=1)if(d=a.cmd[e],d.command===n.OPENCHUNK&&d.chunkName===b&&c(d.crtPt))return d.crtPt;return null},n.cmdCreationRules[n.OPENCHUNK]=function(a,b,c,d){var e=new n.Command(n.OPENCHUNK);return e.chunkName=a.cmd[c].chunkName,e.strDescription=a.cmd[c].strDescription,e};n.expandPaths=function(){var a=document.getElementsByTagName("path"),b=[],c=[],f=[],g=!1;pathparser.addCommands(n.ParseToken),pathparser.addCmdCreationRules(n.cmdCreationRules),l(a,b,c,f);do g=!1,g|=m(b,i,n.OPENCHUNK),g|=m(c,d,n.DIRECTREF),g|=m(f,e,n.REVERSEDREF);while(g);(0!==b.length||0!==c.length||0!==f.length)&&(console.log("Problem: some chunk reference seems impossible to solve!"),0!==b.length&&console.log("Problem with"+b[0].toString()),0!==c.length&&console.log("Problem with reference"+c[0].toString()),0!==f.length&&console.log("Problem with inverse reference"+f[0].toString()))},"function"==typeof define&&define.amd?define(n):"object"==typeof module&&module.exports?module.exports=n:this.superpath=n}).call(this),function(){"use strict";function a(a,b){var c=new RegExp("(["+h+"])(["+h+"])","gm");this.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm," ")},this.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},b=b.replace(/,/gm," "),b=b.replace(c,"$1 $2"),b=b.replace(c,"$1 $2"),c=new RegExp("(["+h+"])([^s])","gm"),b=b.replace(c,"$1 $2"),c=new RegExp("([^s])(["+h+"])","gm"),b=b.replace(c,"$1 $2"),b=b.replace(/([0-9])([+\-])/gm,"$1 $2"),b=b.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),b=b.replace(/([Aa](\s+[0-9]+){3})\s+ ([01])\s*([01])/gm,"$1 $3 $4 "),b=this.compressSpaces(b),b=this.trim(b),c=new RegExp("^["+h+"]$","gm"),this.tokens=b.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new a.Point(0,0),this.control=new a.Point(0,0),this.current=new a.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!==this.tokens[this.i+1].match(c)},this.isRelativeCommand=function(){return-1!==g.indexOf(this.command)},this.getToken=function(){return this.i+=1,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(b){var c=new a.Point(this.getScalar(),this.getScalar());return b?c:this.makeAbsolute(c)},this.getAsControlPoint=function(a){var b=this.getPoint(a);return this.control=b,b},this.getAsCurrentPoint=function(a){var b=this.getPoint(a);return this.current=b,b},this.getReflectedControlPoint=function(){if("c"!==this.previousCommand.toLowerCase()&&"s"!==this.previousCommand.toLowerCase()&&"q"!==this.previousCommand.toLowerCase()&&"t"!==this.previousCommand.toLowerCase())return this.current;var b=new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return b},this.makeAbsolute=function(a){return this.isRelativeCommand()&&a.translate(this.current.x,this.current.y),a}}function b(a){return null!==a&&void 0!==a}function c(a){var c="";return b(a.ctlpt1)&&(c+=a.ctlpt1.x+","+a.ctlpt1.y+" "),b(a.ctlpt2)&&(c+=a.ctlpt2.x+","+a.ctlpt2.y+" "),b(a.target)&&(c+=a.target.x+","+a.target.y),c}function d(a,b,c){var d=new e.Command(a),f=new e.Point(b,c);return d.crtPt=new e.Point(f.x,f.y),d.target=f,d}var e={version:"0.1.0"},f="MZLHVCSQTA",g="mzlhvcsqta",h=f+g,i=function(a,b){var c=a.getAsCurrentPoint(a.isRelativeCommand()),d=new e.Command(a.command);for(d.target=c,d.absEndPt=c,b.push(d),a.start=a.current;!a.isCommandOrEnd();)c=a.getAsCurrentPoint(a.isRelativeCommand()),d=new e.Command("L"),d.target=c,d.absEndPt=new e.Point(c.x,c.y),b.push(d)},j=function(a,c){var d,f;do d=new e.Command(a.command),d.current=a.current,f=a.getAsCurrentPoint(a.isRelativeCommand()),d.target=f,d.absEndPt=new e.Point(f.x,f.y),a.isRelativeCommand(d.command)&&b(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!a.isCommandOrEnd())},k=function(a,c){var d,f,g;do d=new e.Command(a.command),d.current=a.current,f=a.getScalar(),g=new e.Point((a.isRelativeCommand()?a.current.x:0)+f,a.current.y),a.current=g,d.d=(a.isRelativeCommand()?a.current.x:0)+f,d.absEndPt=new e.Point(g.x,g.y),a.isRelativeCommand(d.command)&&b(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!a.isCommandOrEnd())},l=function(a,c){var d,f,g;do d=new e.Command(a.command),d.current=a.current,f=a.getScalar(),g=new e.Point(a.current.x,(a.isRelativeCommand()?a.current.y:0)+f),a.current=g,d.d=(a.isRelativeCommand()?a.current.x:0)+f,d.absEndPt=new e.Point(g.x,g.y),a.isRelativeCommand(d.command)&&b(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!a.isCommandOrEnd())},m=function(a,c){var d,f,g,h;do d=new e.Command(a.command),d.current=a.current,f=a.getAsControlPoint(a.isRelativeCommand()),g=a.getAsControlPoint(a.isRelativeCommand()),h=a.getAsCurrentPoint(a.isRelativeCommand()),d.ctlpt1=f,d.ctlpt2=g,d.target=h,d.absEndPt=new e.Point(h.x,h.y),a.isRelativeCommand(d.command)&&b(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!a.isCommandOrEnd())},n=function(a,b){},o=function(a,c){var d,f,g;do d=new e.Command(a.command),d.current=a.current,f=a.getAsControlPoint(a.isRelativeCommand()),g=a.getAsCurrentPoint(a.isRelativeCommand()),d.ctlpt1=f,d.target=g,d.absEndPt=new e.Point(g.x,g.y),a.isRelativeCommand(d.command)&&b(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!a.isCommandOrEnd())},p=function(a,c){var d,f,g;do d=new e.Command(a.command),d.current=a.current,g=a.getAsCurrentPoint(a.isRelativeCommand()),d.ctlpt1=f,d.target=g,d.absEndPt=new e.Point(g.x,g.y),a.isRelativeCommand(d.command)&&b(c.cmd[c.cmd.length-1].absEndPt)&&d.absEndPt.translate(c.cmd[c.cmd.length-1].absEndPt.x,c.cmd[c.cmd.length-1].absEndPt.y),c.push(d);while(!a.isCommandOrEnd())},q=function(a,b){},r=function(a,b){var c;do c=new e.Command(a.command),c.current=a.current,b.push(c);while(!a.isCommandOrEnd())};e.ParseAbsToken={M:i,L:j,H:k,V:l,C:m,S:n,Q:o,T:p,A:q,Z:r},e.ParseRelToken={m:i,l:j,h:k,v:l,c:m,s:n,q:o,t:p,a:q,z:r},e.ParseToken={},e.addCommands=function(a){for(var b in a)a.hasOwnProperty(b)&&(e.ParseToken[b]=a[b],h+=b)},e.addCommands(e.ParseAbsToken),e.addCommands(e.ParseRelToken),e.TokensToString={h:function(){return this.command+this.d},v:function(){return this.command+this.d},H:function(){return this.command+this.d},V:function(){return this.command+this.d},z:function(){return this.command+c(this)},"default":function(){return this.command+c(this)}},e.Command=function(a){var b={};return b.command=a,b.toString=e.TokensToString[b.command]||e.TokensToString["default"],b};var s=function(a,b,c,e){var f=d(e,a.cmd[c].target.x,a.cmd[c].target.y);return f};e.cmdCreationRules={v:function(a,b,c,e){var f=d(e,b.cmd[c-1].crtPt.x,a.cmd[c].d);return f.d=f.target.y,f},V:function(a,b,c,e){var f=d(e,b.cmd[c-1].crtPt.x,a.cmd[c].d);return"V"===crtcmdcode&&(f.command="v",f.target.y-=b.cmd[c-1].crtPt.y),f.d=f.target.y,f},h:function(a,b,c,e){var f=d(e,a.cmd[c].d,b.cmd[c-1].crtPt.y);return f.d=f.target.x,f},H:function(a,b,c,e){var f=d(e,a.cmd[c].d,b.cmd[c-1].crtPt.y);return"H"===e&&(f.command="h",f.target.x-=b.cmd[c-1].crtPt.x),f.d=f.target.x,f},m:s,M:s,l:s,L:function(a,b,c,e){var f=d(e,a.cmd[c].target.x,a.cmd[c].target.y);return"L"===e&&(f.command="l",f.target.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y)),f},q:function(a,b,c,f){var g=d(f,a.cmd[c].target.x,a.cmd[c].target.y);return g.ctlpt1=new e.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),g},Q:function(a,b,c,f){var g=d(f,a.cmd[c].target.x,a.cmd[c].target.y);return g.ctlpt1=new e.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),("Q"===f||"T"===f)&&(g.command="Q"===f?"q":"t",g.ctlpt1.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y),g.target.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y)),g},c:function(a,b,c,f){var g=d(f,a.cmd[c].target.x,a.cmd[c].target.y);return g.ctlpt1=new e.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),g.ctlpt2=new e.Point(a.cmd[c].ctlpt2.x,a.cmd[c].ctlpt2.y),g},C:function(a,b,c,f){var g=d(f,a.cmd[c].target.x,a.cmd[c].target.y);return g.ctlpt1=new e.Point(a.cmd[c].ctlpt1.x,a.cmd[c].ctlpt1.y),g.ctlpt2=new e.Point(a.cmd[c].ctlpt2.x,a.cmd[c].ctlpt2.y),"C"===f&&(g.command="c",g.ctlpt1.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y),g.ctlpt2.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y),g.target.translate(-b.cmd[c-1].crtPt.x,-b.cmd[c-1].crtPt.y)),g},z:function(a,b,c,d){var f=new e.Command("z");return f},"default":function(a,b,c,d){return null}},e.addCmdCreationRules=function(a){for(var b in a)a.hasOwnProperty(b)&&(e.cmdCreationRules[b]=a[b],h+=b)},e.fullrelativePathCmdList=function(a){var b,c=new e.CmdList,d={},f=null,g=0,h=a.cmd.length;for(d.x=a.cmd[0].target.x,d.y=a.cmd[0].target.y;h>g;){b=a.cmd[g].command;var i=e.cmdCreationRules[b]||e.cmdCreationRules["default"];i&&(f=i(a,c,g,b),f&&(c.cmd.push(f),f=null)),g+=1}return c},e.Point=function(a,b){this.x=a,this.y=b,this.translate=function(a,b){this.x+=a,this.y+=b}},e.CmdList=function(){this.cmd=[];var a=function(a,b,c){var d=new e.Point(-1*c.target.x,-1*c.target.y);b.target=d},b=function(a,b,c){var d=new e.Point(c.target.x,c.target.y);b.ctlpt1=new e.Point(c.ctlpt1.x-d.x,c.ctlpt1.y-d.y),b.target=new e.Point(-1*d.x,-1*d.y)};this.reverseRules={M:a,h:function(a,b,c){b.d=-1*c.d},v:function(a,b,c){b.d=-1*c.d},l:a,c:function(a,b,c){var d=new e.Point(c.target.x,c.target.y);b.ctlpt1=new e.Point(c.ctlpt2.x-d.x,c.ctlpt2.y-d.y),b.ctlpt2=new e.Point(c.ctlpt1.x-d.x,c.ctlpt1.y-d.y),b.target=new e.Point(-1*d.x,-1*d.y)},q:b,t:b},this.reverse=function(){var a,b,c=new e.CmdList;for(a=this.cmd.length-1;a>=0;a-=1){b=new e.Command(this.cmd[a].command);var d=this.reverseRules[b];d(a,b,this.cmd[a]),c.push(b)}return c},this.push=function(a){this.cmd.push(a)},this.toString=function(){for(var a=0,b="";this.cmd.length>a;)b+=this.cmd[a].toString(),a+=1;return b}},e.svg_parse_path=function(c,d){var f,g=c,h=new e.CmdList;for(f=b(d)?this.PathParser=d:this.PathParser=new a(e,g),f.reset();!f.isEnd();)f.nextCommand(),e.ParseToken[f.command](f,h);return h},"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e:this.pathparser=e}.call(this);